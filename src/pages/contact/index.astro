---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ContentWidth from "../../components/ui/ContentWidth.astro";

const whatsappNumber = "51930345270";
const whatsappBase = `https://wa.me/${whatsappNumber}?text=`;
---

<BaseLayout>
  <ContentWidth>
    <div class="py-10">
      <header class="mb-8">
        <h1 class="mt-2 text-3xl sm:text-4xl font-extrabold text-foreground">
          Contacto
        </h1>
        <p class="mt-3 text-muted max-w-2xl">
          Escríbenos por WhatsApp para confirmar compatibilidad, stock y envío. Si prefieres, también puedes dejarnos tu consulta aquí.
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <section class="lg:col-span-7">
          <div class="rounded-2xl border border-white/10 bg-surface/50 p-6">
            <h2 class="text-xl font-extrabold text-foreground">Arma tu mensaje para WhatsApp</h2>
            <p class="text-muted mt-2">
              Completa estos datos para enviarnos un mensaje más claro por WhatsApp y confirmar compatibilidad más rápido.
            </p>

            <form id="contactForm" class="mt-6 space-y-4">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-foreground" for="name">Nombre</label>
                  <input
                    id="name"
                    name="name"
                    required
                    placeholder="Tu nombre"
                    class="mt-2 w-full rounded-xl bg-background/50 border border-white/10 px-4 py-3 text-foreground placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-foreground" for="phone">WhatsApp / Teléfono</label>
                  <input
                    id="phone"
                    name="phone"
                    required
                    placeholder="Ej: 941 801 827"
                    class="mt-2 w-full rounded-xl bg-background/50 border border-white/10 px-4 py-3 text-foreground placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
                  />
                </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-foreground" for="projectorModel">
                    Modelo de proyector (recomendado)
                  </label>
                  <input
                    id="projectorModel"
                    name="projectorModel"
                    class="mt-2 w-full rounded-xl bg-background/50 border border-white/10 px-4 py-3 text-foreground placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
                  />
                  <p class="mt-2 text-xs text-muted">
                    Si no lo sabes, puedes enviar foto de la etiqueta por WhatsApp.
                  </p>
                </div>

                <div>
                  <label class="block text-sm font-medium text-foreground" for="lampCode">
                    Código de lámpara (opcional)
                  </label>
                  <input
                    id="lampCode"
                    name="lampCode"
                    placeholder="Ej: ELPLP88 / DT01025"
                    class="mt-2 w-full rounded-xl bg-background/50 border border-white/10 px-4 py-3 text-foreground placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
                  />
                </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-foreground" for="district">
                    Distrito / Ciudad (opcional)
                  </label>
                  <input
                    id="district"
                    name="district"
                    placeholder="Ej: Chorrillos / Arequipa"
                    class="mt-2 w-full rounded-xl bg-background/50 border border-white/10 px-4 py-3 text-foreground placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-foreground" for="document">
                    DNI / RUC (opcional)
                  </label>
                  <input
                    id="document"
                    name="document"
                    placeholder="Si requiere boleta/factura"
                    class="mt-2 w-full rounded-xl bg-background/50 border border-white/10 px-4 py-3 text-foreground placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
                  />
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-foreground" for="message">Mensaje</label>
                <textarea
                  id="message"
                  name="message"
                  rows="5"
                  required
                  placeholder="Cuéntanos qué necesitas. Ej: mantenimiento preventivo de equipo..."
                  class="mt-2 w-full rounded-xl bg-background/50 border bordºer-white/10 px-4 py-3 text-foreground placeholder:text-muted outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
                ></textarea>
              </div>

              <div class="pt-2 flex flex-col sm:flex-row gap-3">
                <a
                  id="whatsBtn"
                  href={`${whatsappBase}${encodeURIComponent("Hola, quiero cotizar una lámpara para proyector. ¿Me ayudas?")}`}
                  target="_blank"
                  class="inline-flex items-center gap-2 justify-center rounded-xl bg-primary text-black font-semibold px-6 py-3 hover:bg-primary-hover transition"
                >
                  <svg class="w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                    <path d="M476.9 161.1C435 119.1 379.2 96 319.9 96C197.5 96 97.9 195.6 97.9 318C97.9 357.1 108.1 395.3 127.5 429L96 544L213.7 513.1C246.1 530.8 282.6 540.1 319.8 540.1L319.9 540.1C442.2 540.1 544 440.5 544 318.1C544 258.8 518.8 203.1 476.9 161.1zM319.9 502.7C286.7 502.7 254.2 493.8 225.9 477L219.2 473L149.4 491.3L168 423.2L163.6 416.2C145.1 386.8 135.4 352.9 135.4 318C135.4 216.3 218.2 133.5 320 133.5C369.3 133.5 415.6 152.7 450.4 187.6C485.2 222.5 506.6 268.8 506.5 318.1C506.5 419.9 421.6 502.7 319.9 502.7zM421.1 364.5C415.6 361.7 388.3 348.3 383.2 346.5C378.1 344.6 374.4 343.7 370.7 349.3C367 354.9 356.4 367.3 353.1 371.1C349.9 374.8 346.6 375.3 341.1 372.5C308.5 356.2 287.1 343.4 265.6 306.5C259.9 296.7 271.3 297.4 281.9 276.2C283.7 272.5 282.8 269.3 281.4 266.5C280 263.7 268.9 236.4 264.3 225.3C259.8 214.5 255.2 216 251.8 215.8C248.6 215.6 244.9 215.6 241.2 215.6C237.5 215.6 231.5 217 226.4 222.5C221.3 228.1 207 241.5 207 268.8C207 296.1 226.9 322.5 229.6 326.2C232.4 329.9 268.7 385.9 324.4 410C359.6 425.2 373.4 426.5 391 423.9C401.7 422.3 423.8 410.5 428.4 397.5C433 384.5 433 373.4 431.6 371.1C430.3 368.6 426.6 367.2 421.1 364.5z"/>
                  </svg>
                  <span>Enviar por WhatsApp</span>
                </a>
              </div>

              <p class="text-xs text-muted leading-6">
                Al enviar, aceptas que te contactemos para confirmar compatibilidad, stock y envío. No compartimos tus datos con terceros.
              </p>
            </form>
          </div>
        </section>

        <aside class="lg:col-span-5">
          <div class="rounded-2xl border border-white/10 bg-surface/50 p-6 lg:sticky lg:top-6">
            <h2 class="text-xl font-extrabold text-foreground">¿Prefieres escribir directo?</h2>
            <p class="text-muted mt-2">
              Para validar compatibilidad más rápido, envía por WhatsApp:
            </p>

            <ul class="mt-4 space-y-2 text-sm text-muted">
              <li class="flex gap-2">
                <svg class="w-6 text-success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                  <path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 112C205.1 112 112 205.1 112 320C112 434.9 205.1 528 320 528C434.9 528 528 434.9 528 320C528 205.1 434.9 112 320 112zM390.7 233.9C398.5 223.2 413.5 220.8 424.2 228.6C434.9 236.4 437.3 251.4 429.5 262.1L307.4 430.1C303.3 435.8 296.9 439.4 289.9 439.9C282.9 440.4 276 437.9 271.1 433L215.2 377.1C205.8 367.7 205.8 352.5 215.2 343.2C224.6 333.9 239.8 333.8 249.1 343.2L285.1 379.2L390.7 234z"/>
                </svg>
                <span>Modelo exacto del proyector</span>
              </li>
              <li class="flex gap-2">
                <svg class="w-6 text-success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                  <path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 112C205.1 112 112 205.1 112 320C112 434.9 205.1 528 320 528C434.9 528 528 434.9 528 320C528 205.1 434.9 112 320 112zM390.7 233.9C398.5 223.2 413.5 220.8 424.2 228.6C434.9 236.4 437.3 251.4 429.5 262.1L307.4 430.1C303.3 435.8 296.9 439.4 289.9 439.9C282.9 440.4 276 437.9 271.1 433L215.2 377.1C205.8 367.7 205.8 352.5 215.2 343.2C224.6 333.9 239.8 333.8 249.1 343.2L285.1 379.2L390.7 234z"/>
                </svg>
                <span>Código de la lámpara (si lo tienes)</span>
              </li>
              <li class="flex gap-2">
                <svg class="w-6 text-success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                  <path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 112C205.1 112 112 205.1 112 320C112 434.9 205.1 528 320 528C434.9 528 528 434.9 528 320C528 205.1 434.9 112 320 112zM390.7 233.9C398.5 223.2 413.5 220.8 424.2 228.6C434.9 236.4 437.3 251.4 429.5 262.1L307.4 430.1C303.3 435.8 296.9 439.4 289.9 439.9C282.9 440.4 276 437.9 271.1 433L215.2 377.1C205.8 367.7 205.8 352.5 215.2 343.2C224.6 333.9 239.8 333.8 249.1 343.2L285.1 379.2L390.7 234z"/>
                </svg>
                <span>Foto de la etiqueta del proyector (si no sabes el modelo)</span>
              </li>
              <li class="flex gap-2">
                <svg class="w-6 text-success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                  <path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM320 112C205.1 112 112 205.1 112 320C112 434.9 205.1 528 320 528C434.9 528 528 434.9 528 320C528 205.1 434.9 112 320 112zM390.7 233.9C398.5 223.2 413.5 220.8 424.2 228.6C434.9 236.4 437.3 251.4 429.5 262.1L307.4 430.1C303.3 435.8 296.9 439.4 289.9 439.9C282.9 440.4 276 437.9 271.1 433L215.2 377.1C205.8 367.7 205.8 352.5 215.2 343.2C224.6 333.9 239.8 333.8 249.1 343.2L285.1 379.2L390.7 234z"/>
                </svg>
                <span>Ciudad/Distrito para envío</span>
              </li>
            </ul>

            <a
              href={`${whatsappBase}${encodeURIComponent("Hola, quiero confirmar compatibilidad de una lámpara para mi proyector.")}`}
              target="_blank"
              class="mt-6 w-full inline-flex gap-2 items-center justify-center rounded-xl bg-success/20 text-success border border-success/30 font-semibold px-6 py-3 hover:bg-success/25 transition"
            >
              <svg class="w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                <path d="M476.9 161.1C435 119.1 379.2 96 319.9 96C197.5 96 97.9 195.6 97.9 318C97.9 357.1 108.1 395.3 127.5 429L96 544L213.7 513.1C246.1 530.8 282.6 540.1 319.8 540.1L319.9 540.1C442.2 540.1 544 440.5 544 318.1C544 258.8 518.8 203.1 476.9 161.1zM319.9 502.7C286.7 502.7 254.2 493.8 225.9 477L219.2 473L149.4 491.3L168 423.2L163.6 416.2C145.1 386.8 135.4 352.9 135.4 318C135.4 216.3 218.2 133.5 320 133.5C369.3 133.5 415.6 152.7 450.4 187.6C485.2 222.5 506.6 268.8 506.5 318.1C506.5 419.9 421.6 502.7 319.9 502.7zM421.1 364.5C415.6 361.7 388.3 348.3 383.2 346.5C378.1 344.6 374.4 343.7 370.7 349.3C367 354.9 356.4 367.3 353.1 371.1C349.9 374.8 346.6 375.3 341.1 372.5C308.5 356.2 287.1 343.4 265.6 306.5C259.9 296.7 271.3 297.4 281.9 276.2C283.7 272.5 282.8 269.3 281.4 266.5C280 263.7 268.9 236.4 264.3 225.3C259.8 214.5 255.2 216 251.8 215.8C248.6 215.6 244.9 215.6 241.2 215.6C237.5 215.6 231.5 217 226.4 222.5C221.3 228.1 207 241.5 207 268.8C207 296.1 226.9 322.5 229.6 326.2C232.4 329.9 268.7 385.9 324.4 410C359.6 425.2 373.4 426.5 391 423.9C401.7 422.3 423.8 410.5 428.4 397.5C433 384.5 433 373.4 431.6 371.1C430.3 368.6 426.6 367.2 421.1 364.5z"/>
              </svg>
              <span>WhatsApp directo (sin formulario)</span>
            </a>

            <div class="mt-6 rounded-xl border border-white/10 bg-background/40 p-4">
              <p class="text-sm text-muted">Horario</p>
              <p class="text-foreground font-semibold mt-1">Lunes a viernes: 09:00 - 19:00</p>
            </div>

            <div class="mt-4 rounded-xl border border-white/10 bg-background/40 p-4">
              <p class="text-sm text-muted">Contacto</p>
              <div class="mt-2 space-y-2 text-sm">
                <p class="text-foreground flex gap-2">
                  <svg class="w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                    <path d="M224.2 89C216.3 70.1 195.7 60.1 176.1 65.4L170.6 66.9C106 84.5 50.8 147.1 66.9 223.3C104 398.3 241.7 536 416.7 573.1C493 589.3 555.5 534 573.1 469.4L574.6 463.9C580 444.2 569.9 423.6 551.1 415.8L453.8 375.3C437.3 368.4 418.2 373.2 406.8 387.1L368.2 434.3C297.9 399.4 241.3 341 208.8 269.3L253 233.3C266.9 222 271.6 202.9 264.8 186.3L224.2 89z"/>
                  </svg>
                  <a href="tel:51930345270">+51 930 345 270</a>
                </p>
                <p class="text-foreground flex gap-2">
                  <svg class="w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                    <path d="M224.2 89C216.3 70.1 195.7 60.1 176.1 65.4L170.6 66.9C106 84.5 50.8 147.1 66.9 223.3C104 398.3 241.7 536 416.7 573.1C493 589.3 555.5 534 573.1 469.4L574.6 463.9C580 444.2 569.9 423.6 551.1 415.8L453.8 375.3C437.3 368.4 418.2 373.2 406.8 387.1L368.2 434.3C297.9 399.4 241.3 341 208.8 269.3L253 233.3C266.9 222 271.6 202.9 264.8 186.3L224.2 89z"/>
                  </svg>
                  <a href="tel:51972252744">+51 972 252 744</a>
                </p>
                <p class="text-foreground flex gap-2">
                  <svg class="w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                    <path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/>
                  </svg>
                  <a href="mailto:contactos@servitec-peru.com">contactos@servitec-peru.com</a>
                </p>
                <p class="text-foreground flex gap-2">
                  <svg class="w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                    <path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/>
                  </svg>
                  <a href="mailto:contacto@servitecperu.com">contacto@servitecperu.com</a>
                </p>
              </div>
            </div>

            <div class="mt-4 text-xs text-muted leading-6">
              Razón social: Servitec Perú Group E.I.R.L. · RUC: 20604141240
            </div>
          </div>
        </aside>
      </div>
    </div>
  </ContentWidth>

  <script is:inline>
    (() => {
      const whatsappNumber = "51930345270";
      const form = document.getElementById("contactForm");
      const whatsBtn = document.getElementById("whatsBtn");

      const REQUIRED_IDS = ["name", "phone", "projectorModel"];

      const getEl = (id) => document.getElementById(id);

      const getValue = (id) => (getEl(id)?.value || "").trim();

      function setFieldError(id, hasError) {
        const el = getEl(id);
        if (!el) return;
        el.classList.toggle("border-error", hasError);
        el.classList.toggle("focus:border-error", hasError);
        el.classList.toggle("focus:ring-error/20", hasError);
      }

      function ensureAlertEl() {
        let alert = document.getElementById("formAlert");
        if (alert) return alert;

        alert = document.createElement("div");
        alert.id = "formAlert";
        alert.className =
          "hidden mt-4 rounded-xl border border-error/30 bg-error/10 px-4 py-3 text-sm text-error";
        alert.textContent = "Completa los campos requeridos para enviar por WhatsApp.";
        form?.prepend(alert);
        return alert;
      }

      function isPhoneValid(phone) {
        const digits = phone.replace(/\D/g, "");
        return digits.length >= 9;
      }

      function validate() {
        const alert = ensureAlertEl();
        let ok = true;

        REQUIRED_IDS.forEach((id) => setFieldError(id, false));
        alert.classList.add("hidden");

        const name = getValue("name");
        if (!name) {
          setFieldError("name", true);
          ok = false;
        }

        const phone = getValue("phone");
        if (!phone || !isPhoneValid(phone)) {
          setFieldError("phone", true);
          ok = false;
        }

        const model = getValue("projectorModel");
        if (!model) {
          setFieldError("projectorModel", true);
          ok = false;
        }

        if (!ok) alert.classList.remove("hidden");
        return ok;
      }

      function buildText() {
        const name = getValue("name");
        const phone = getValue("phone");
        const model = getValue("projectorModel");

        const code = getValue("lampCode");
        const district = getValue("district");
        const documentId = getValue("document");
        const message = getValue("message");

        let txt =
          "Hola, quiero cotizar una lámpara para proyector.\n\n" +
          `Nombre: ${name}\n` +
          `WhatsApp: ${phone}\n` +
          `Modelo de proyector: ${model}\n`;

        if (code) txt += `Código de lámpara: ${code}\n`;
        if (district) txt += `Distrito/Ciudad: ${district}\n`;
        if (documentId) txt += `DNI/RUC: ${documentId}\n`;
        if (message) txt += `\nMensaje: ${message}\n`;

        txt += "\n¿Me confirmas compatibilidad, stock y envío?";
        return encodeURIComponent(txt);
      }

      function syncWhatsLink() {
        if (!whatsBtn) return;
        const url = `https://wa.me/${whatsappNumber}?text=${buildText()}`;
        whatsBtn.setAttribute("href", url);
      }

      ["name","phone","projectorModel","lampCode","district","document","message"].forEach((id) => {
        getEl(id)?.addEventListener("input", () => {
          if (REQUIRED_IDS.includes(id)) setFieldError(id, false);
          syncWhatsLink();
        });
        getEl(id)?.addEventListener("blur", () => {
          if (!REQUIRED_IDS.includes(id)) return;
          const val = getValue(id);
          if (id === "phone") setFieldError(id, !(val && isPhoneValid(val)));
          else setFieldError(id, !val);
        });
      });

      whatsBtn?.addEventListener("click", (e) => {
        const ok = validate();
        if (!ok) {
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        syncWhatsLink();
      });

      form?.addEventListener("submit", (e) => {
        e.preventDefault();
        const ok = validate();
        if (!ok) return;
        syncWhatsLink();
        window.open(whatsBtn.getAttribute("href"), "_blank");
      });

      syncWhatsLink();
    })();
  </script>

</BaseLayout>
